<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    
</body>
</html>

<script src="../lib/pixi.js"></script>
<script type="text/javascript">
    const randomInt = (from, to) => Math.round((to - from) * Math.random()) + from;

    const Application = PIXI.Application,
        Graphics = PIXI.Graphics,
        Texture = PIXI.Texture;

    const app = new Application({
        width: 1200,
        height: 600,
        backgroundColor: 0xeef0f1,
        antialias: true,    // default: false 反锯齿
        transparent: false, // default: false 透明度
        resolution: 1       // default: 1 分辨率
    });

    document.body.appendChild(app.view);

    const doorTexture = Texture.from('./images/door.png');

    // rectangle
    const rectangle = new Graphics();

    rectangle.beginTextureFill({
        texture: doorTexture
    });

    rectangle.drawRect(0, 0 , 100, 130);

    app.stage.addChild(rectangle);

    const rectHole = new PIXI.Polygon([
        [50, 50], [50, 100], [100, 100], [100, 50]
    ].map(([x, y]) => new PIXI.Point(x, y)))

    rectangle.geometry.drawHole(rectHole);

    // polygon 
    const randomPoint = [200, 500]
    const polygonGraphics = new Graphics();

    const start = Date.now();

    app.ticker.add(() => {
        const now = Date.now();

        randomPoint[0] = 200 * (Math.sin((now - start) / 1000) * 0.1 + 1);
        randomPoint[1] = 500 * (Math.cos((now - start) / 1000) * 0.1 + 1);

        const polygon = new PIXI.Polygon([
            [0, 150], [0, 200], [150, 300], randomPoint, [300, 500], [350, 300], [200, 150]
        ].map(([x, y]) => new PIXI.Point(x, y)))

        polygonGraphics
            .clear()
            .lineStyle(10, 0x66CCFF)
            .beginTextureFill({ texture: doorTexture })
            .drawPolygon(polygon)
            .drawCircle(...randomPoint, 5);
    });

    app.stage.addChild(polygonGraphics);

    // door
    const drawDoor = (doorGraphics, width, wallThickness, flip = 0) => {
        const DOOR_THICKNESS = 10;

        doorGraphics
            .lineStyle(1, 0x000000)
            .beginFill(0x000000, .1)
            .arc(width * flip, wallThickness / 2, width, Math.PI * flip / 2, Math.PI * flip / 2 + Math.PI / 2)
            .lineTo(width * flip, wallThickness / 2)
            .lineTo(width, width * flip + wallThickness / 2)
            .endFill()
            .beginFill(0xFFFFFF)
            .lineStyle(2, 0x000000)
            .drawRect(0, 0, width, wallThickness)
            .lineStyle(2, 0xFFFFFF)
            .moveTo(0, 0)
            .lineTo(width, 0)
            .moveTo(0, wallThickness)
            .lineTo(width, wallThickness)
            .lineStyle(2, 0x000000)
            .drawRect((width - DOOR_THICKNESS) * flip, wallThickness / 2, DOOR_THICKNESS, width)

        doorGraphics.pivot.x = width / 2
        doorGraphics.pivot.y = wallThickness / 2

        app.stage.addChild(doorGraphics);

        return doorGraphics;
    }

    const door = new PIXI.Graphics();

    drawDoor(door, 200, 50, 1);

    door.y = 100;
    door.x = 700;
    door.rotation = Math.PI / 8

    const circle = new PIXI.Circle(0, 0, 5);

    // wondow
    const drawWindow = () => {

    }

</script>